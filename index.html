<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2019-11-05 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20191105" />
    <meta http-equiv="Content-Language" content="en" />
    <title>microBean™ Jersey Netty Integration &#x2013; microBean™ Jersey Netty Integration</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>microBean™ Jersey Netty Integration</h2>
</div>
</div>
        <div class="pull-right"><a href="https://microbean.github.io/microbean-jersey-netty" id="bannerRight"><img src="https://avatars0.githubusercontent.com/u/25515632?s=60"  alt="μb microbean-jersey-netty"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2019-11-05</li>
      <li id="projectVersion" class="pull-right">Version: 0.21.0</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Documentation</li>
    <li class="active"><a href="#"><span class="none"></span>Overview</a>
  </li>
    <li><a href="apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a>  </li>
    <li><a href="https://github.com/microbean/microbean-jersey-netty/" class="externalLink" title="Github Repository"><span class="none"></span>Github Repository</a>  </li>
    <li><a href="examples.html" title="Examples"><span class="none"></span>Examples</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-down"></span>Project Information</a>
      <ul class="nav nav-list">
    <li><a href="dependencies.html" title="Dependencies"><span class="none"></span>Dependencies</a>  </li>
    <li><a href="dependency-info.html" title="Dependency Information"><span class="none"></span>Dependency Information</a>  </li>
    <li><a href="dependency-management.html" title="Dependency Management"><span class="none"></span>Dependency Management</a>  </li>
    <li><a href="distribution-management.html" title="Distribution Management"><span class="none"></span>Distribution Management</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>About</a>
  </li>
    <li><a href="issue-management.html" title="Issue Management"><span class="none"></span>Issue Management</a>  </li>
    <li><a href="licenses.html" title="Licenses"><span class="none"></span>Licenses</a>  </li>
    <li><a href="plugin-management.html" title="Plugin Management"><span class="none"></span>Plugin Management</a>  </li>
    <li><a href="plugins.html" title="Plugins"><span class="none"></span>Plugins</a>  </li>
    <li><a href="scm.html" title="Source Code Management"><span class="none"></span>Source Code Management</a>  </li>
    <li><a href="summary.html" title="Summary"><span class="none"></span>Summary</a>  </li>
    <li><a href="team.html" title="Team"><span class="none"></span>Team</a>  </li>
      </ul>
  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>microBean&#x2122; Jersey Netty Integration</h1>
<p><a class="externalLink" href="https://travis-ci.com/microbean/microbean-jersey-netty"><img src="https://travis-ci.com/microbean/microbean-jersey-netty.svg?branch=master" alt="Build Status" /></a> <a class="externalLink" href="https://maven-badges.herokuapp.com/maven-central/org.microbean/microbean-jersey-netty"><img src="https://maven-badges.herokuapp.com/maven-central/org.microbean/microbean-jersey-netty/badge.svg" alt="Maven Central" /></a></p>
<p>The microBean&#x2122; Jersey Netty Integration project integrates <a class="externalLink" href="https://jersey.github.io/">Jersey</a> into <a class="externalLink" href="https://netty.io">Netty</a> in an idiomatic way.</p>
<p>Jersey can be run as a simple handler of sorts in a <a class="externalLink" href="http://tutorials.jenkov.com/netty/netty-channelpipeline.html">Netty pipeline</a>. The Netty event loop remains unblocked, there is no locking, reads and writes involve no copying of byte arrays, output is streamed where appropriate and it is intended that there be as few object allocations as possible.</p>
<p>HTTP 1.1 and HTTP/2 are both supported, including upgrades via <a class="externalLink" href="https://svn.tools.ietf.org/svn/wg/httpbis/specs/rfc7230.html#header.upgrade">HTTP&#x2019;s upgrade header</a>, <a class="externalLink" href="https://www.rfc-editor.org/rfc/rfc7301#page-2">ALPN</a> or <a class="externalLink" href="https://http2.github.io/http2-spec/#known-http">prior knowledge</a>.</p>
<div class="section">
<h2><a name="Status"></a>Status</h2>
<p>This project uses <a class="externalLink" href="https://semver.org/">semantic versioning</a>.  It is still in an alpha state.</p></div>
<div class="section">
<h2><a name="Installation"></a>Installation</h2>
<p>Add a dependency on this project in your Netty-based Maven project:</p>

<div>
<div>
<pre class="source">&lt;dependency&gt;
  &lt;groupId&gt;org.microbean&lt;/groupId&gt;
  &lt;artifactId&gt;microbean-jersey-netty&lt;/artifactId&gt;
  &lt;version&gt;0.21.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div>
</div>
<div class="section">
<h2><a name="Usage"></a>Usage</h2>
<p>To use, install an instance of <a class="externalLink" href="https://microbean.github.io/microbean-jersey-netty/apidocs/org/microbean/jersey/netty/JerseyChannelInitializer.html"><tt>JerseyChannelInitializer</tt></a> as the <a class="externalLink" href="https://netty.io/4.1/api/io/netty/bootstrap/ServerBootstrap.html#childHandler-io.netty.channel.ChannelHandler-">child handler</a> of a Netty <a class="externalLink" href="https://netty.io/4.1/api/io/netty/bootstrap/ServerBootstrap.html"><tt>ServerBootstrap</tt></a>:</p>

<div>
<div>
<pre class="source">serverBootstrap.childHandler(new JerseyChannelInitializer(baseUri, // e.g. URI.create(&quot;/&quot;)
    sslContext, // an SslContext, or null if you don't want TLS support
    true, // yes, HTTP/2 support please
    20971520L, // 20MB maximum incoming payload (arbitrary)
    new DefaultEventExecutorGroup(8), // a DefaultEventExecutorGroup with 8 threads (arbitrary) to run your application
    true, // yes, use Jersey's native dependency injection facilities
    new ApplicationHandler(yourJaxRsApplication), // the ApplicationHandler wrapping your application
    8192, // write in 8K chunks (arbitrary)
    Unpooled::new /* how to create those chunks */));
</pre></div></div>
</div>
<div class="section">
<h2><a name="Background_and_Motivation"></a>Background and Motivation</h2>
<p>While Jersey itself contains a <a class="externalLink" href="https://github.com/eclipse-ee4j/jersey/tree/master/containers/netty-http">Netty integration project</a>, it is annotated with <a class="externalLink" href="https://jersey.github.io/apidocs/2.28/jersey/org/glassfish/jersey/Beta.html"><tt>@Beta</tt></a>, and the author additionally writes that his &#x201c;implementation cannot be more experimental&#x201d;.  In addition, there are several issues with the Jersey-supplied Netty integration project.  The most problematic seems to be <a class="externalLink" href="https://github.com/eclipse-ee4j/jersey/issues/3500">issue 3500</a>.  This issue and others stem from the fact that the Jersey-supplied Netty integration project sets up its own internal queues for streaming, which overflow.  Additionally, new <tt>ByteBuffer</tt>s and <tt>InputStream</tt>s are allocated throughout.  It is also not entirely clear if HTTP/2 is fully supported.</p></div>
<div class="section">
<h2><a name="Implementation_Details"></a>Implementation Details</h2>
<p>By contrast, microBean&#x2122; Jersey Netty Integration approaches the problem of running a Jakarta RESTful Web Services application under Netty by following the spirit of Netty.</p>
<p>Several composable channel pipeline components are provided.</p>
<p>Considering HTTP 1.1 support, the first is a <a class="externalLink" href="https://netty.io/4.1/api/io/netty/handler/codec/MessageToMessageDecoder.html"><i>decoder</i></a> that decodes <a class="externalLink" href="https://netty.io/4.1/api/io/netty/handler/codec/http/HttpRequest.html"><tt>HttpRequest</tt></a> and <a class="externalLink" href="https://netty.io/4.1/api/io/netty/handler/codec/http/HttpContent.html"><tt>HttpContent</tt></a> messages into <a class="externalLink" href="https://eclipse-ee4j.github.io/jersey.github.io/apidocs/latest/jersey/org/glassfish/jersey/server/ContainerRequest.html"><tt>ContainerRequest</tt></a> objects, which are the objects consumed natively by Jersey.</p>
<p>A <a class="externalLink" href="https://eclipse-ee4j.github.io/jersey.github.io/apidocs/latest/jersey/org/glassfish/jersey/server/ContainerRequest.html"><tt>ContainerRequest</tt></a> may need an <a class="externalLink" href="https://eclipse-ee4j.github.io/jersey.github.io/apidocs/latest/jersey/org/glassfish/jersey/server/ContainerRequest.html#setEntityStream-java.io.InputStream-">entity stream</a>, and that can be tricky.  Since a Jakarta RESTful Web Services application may block whatever thread it is running on for some time (for example, perhaps it is performing synchronous database access over a slow connection), then normally it should be run on its own thread that is not the Netty event loop.  But assuming that is so, the <tt>InputStream</tt> it will receive by way of a <a class="externalLink" href="https://eclipse-ee4j.github.io/jersey.github.io/apidocs/latest/jersey/org/glassfish/jersey/server/ContainerRequest.html#setEntityStream-java.io.InputStream-"><tt>ContainerRequest</tt>&#x2019;s entity stream</a> will now be operated on by two threads: the application-hosting thread, and the Netty event loop.  microBean&#x2122; Jersey Netty Integration ensures that <a class="externalLink" href="https://microbean.github.io/microbean-jersey-netty/apidocs/org/microbean/jersey/netty/TerminableByteBufInputStream.html">this <tt>InputStream</tt> implementation</a> is thread-safe, uses as few locks as possible, allocates as little memory as possible, and takes advantage of <a class="externalLink" href="https://netty.io/4.1/api/io/netty/buffer/CompositeByteBuf.html"><tt>CompositeByteBuf</tt></a> and other Netty native constructs to ensure this inter-thread messaging is safe and efficient.</p>
<p>Similarly, a <tt>ContainerRequest</tt> needs a <a class="externalLink" href="https://eclipse-ee4j.github.io/jersey.github.io/apidocs/latest/jersey/org/glassfish/jersey/server/spi/ContainerResponseWriter.html#writeResponseStatusAndHeaders-long-org.glassfish.jersey.server.ContainerResponse-"><tt>ContainerResponseWriter</tt></a> which is responsible for actually writing the Jakarta RESTful Web Services application&#x2019;s output.  microBean&#x2122; Jersey Netty Integration provides a <tt>ContainerResponseWriter</tt> implementation that is also a <a class="externalLink" href="https://netty.io/4.1/api/io/netty/channel/ChannelInboundHandlerAdapter.html"><tt>ChannelInboundHandlerAdapter</tt></a>: it takes <tt>ContainerRequest</tt>s as input, installs itself as their <tt>ContainerResponseWriter</tt> implementation, and writes the requisite output back to the channel safely and efficiently.</p>
<p>The <tt>OutputStream</tt> implementation used to do this must, of course, ensure that writes take place on the Netty event loop.  microBean&#x2122; Jersey Netty Integration ensures that <a class="externalLink" href="https://microbean.github.io/microbean-jersey-netty/apidocs/org/microbean/jersey/netty/ByteBufBackedChannelOutboundInvokingHttpContentOutputStream.html">this <tt>OutputStream</tt> implementation</a> does not needlessly buffer and/or copy <tt>byte</tt> arrays but instead takes advantage of the built-in outbound event queuing present in the Netty event loop itself.</p>
<p>Similar constructs are provided for HTTP/2 support as well.</p></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2019
<a href="http://microbean.systems/">microBean™</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
